# ruins of the forge
mem_ancestors_grudge_building_ruins = {
	base_buildtime = @b2_time
	can_build = no
	can_be_disabled = no
	can_be_ruined = no
	can_demolish = no
	category = resource
	resources = {
		category = planet_buildings
		cost = {
			minerals = 900
		}
	}
	planet_modifier = {
		planet_housing_add = 1
	}
	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = {
				is_regular_empire = yes
			}
		}
		modifier = {
			job_scrap_miner_add = 1
		}
	}
	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = {
				is_gestalt = yes
			}
		}
		modifier = {
			job_scrap_miner_drone_add = 1
		}
	}
	triggered_desc = {
		trigger = {
			exists = owner
			owner = {
				is_gestalt = yes
			}
		}
		text = job_scrap_miner_drone_effect_desc
	}
	triggered_desc = {
		trigger = {
			exists = owner
			owner = {
				is_regular_empire = yes
			}
		}
		text = job_scrap_miner_effect_desc
	}
	upgrades = {
		mem_ancestors_grudge_building_ruins_1
	}
}

mem_ancestors_grudge_building_ruins_1 = {
	base_buildtime = @b2_time
	can_build = no
	can_be_disabled = no
	#can_be_ruined = no
	can_demolish = no
	category = resource
	# planet_modifier = {
	# 	planet_max_buildings_add = 1
	# }
	resources = {
		category = planet_buildings
		cost = {
			minerals = 450
		}
	}
	triggered_desc = {
		text = mem_ancestors_grudge_building_ruins_effect
	}
	triggered_desc = {
		trigger = {
			owner = {
				is_mem_runesmith = yes
			}
		}
		text = mem_ancestors_grudge_boosts_repairs_effect
	}
	on_built = {
		remove_building = mem_ancestors_grudge_building_ruins_1
		# owner = {
		# 	mem_ancestors_grudge_give_random_archeotech = yes
		# }
		hidden_effect = {
			owner = {
				country_event = {
					id = mem_ancestors_grudge.30
				}
			}
		}
	}
}

# ruins of the forge
mem_ancestors_grudge_building_forge_0 = {
	base_buildtime = @b2_time
	can_build = no
	can_be_disabled = no
	can_be_ruined = no
	can_demolish = no
	position_priority = 1
	#empire_limit = 1
	category = resource
	resources = {
		category = planet_buildings
		cost = {
			minerals = 900
			#minor_artifacts = 100
		}
		# upkeep = {
		# 	energy = 8
		# 	minerals = 10
		# }
		# produces = {
		# 	minor_artifacts = 5
		# }
	}
	# triggered_planet_modifier = {
	# 	potential = {
	# 		owner = {
	# 			is_mem_runesmith = yes
	# 		}
	# 	}
	# 	planet_miners_minor_artifacts_produces_add = 0.1
	# }
	upgrades = {
		mem_ancestors_grudge_building_forge_1
	}
}

mem_ancestors_grudge_building_forge_1 = {
	base_buildtime = @b3_time
	can_build = no
	can_be_disabled = no
	can_be_ruined = no
	can_demolish = no
	position_priority = 1
	#empire_limit = 1
	category = resource
	allow = {
		owner = {
			is_mem_runesmith = yes
		}
		custom_tooltip = mem_ancestors_grudge_building_forge_1_tt
		hidden_trigger = {
			has_planet_flag = mem_ancestors_grudge_building_forge_1
		}
		#has_planet_flag = mem_ancestors_grudge_building_forge_1
	}
	resources = {
		category = planet_buildings
		cost = {
			minerals = 1800
			alloys = 600
		}
		cost = {
			trigger = {
				host_has_dlc = "Ancient Relics Story Pack"
			}
			minor_artifacts = 300
		}
		upkeep = {
			energy = 8
			minerals = 12
		}
		produces = {
			trigger = {
				host_has_dlc = "Ancient Relics Story Pack"
			}
			minor_artifacts = 4
		}
	}
	inline_script = {
		script = mem_ancestors_grudge/mem_ancestors_grudge_building_forge_1
	}
	# on_built = {
	# }
	upgrades = {
		mem_ancestors_grudge_building_forge_2
	}
	ai_weight = {
		base = 9996
	}
}

#additional jobs
mem_ancestors_grudge_building_forge_2 = {
	base_buildtime = @b3_time
	can_build = no
	can_be_disabled = no
	can_be_ruined = no
	can_demolish = no
	position_priority = 1
	#empire_limit = 1
	category = resource
	allow = {
		owner = {
			is_mem_runesmith = yes
		}
		custom_tooltip = mem_ancestors_grudge_building_forge_1_tt
		hidden_trigger = {
			has_planet_flag = mem_ancestors_grudge_building_forge_2
		}
		#has_planet_flag = mem_ancestors_grudge_building_forge_1
	}
	resources = {
		category = planet_buildings
		cost = {
			minerals = 1800
			alloys = 800
		}
		cost = {
			trigger = {
				host_has_dlc = "Ancient Relics Story Pack"
			}
			minor_artifacts = 1200
		}
		upkeep = {
			energy = 12
			#minerals = 12
			alloys = 6
		}
		produces = {
			trigger = {
				host_has_dlc = "Ancient Relics Story Pack"
			}
			minor_artifacts = 8
		}
	}
	inline_script = {
		script = mem_ancestors_grudge/mem_ancestors_grudge_building_forge_2
	}
	inline_script = {
		script = mem_ancestors_grudge/mem_ancestors_grudge_building_forge_1
	}
	on_built = {
		owner = {
			country_event = {
				id = mem_ancestors_grudge.40
			}
			# start_situation = {
			# 	type = situation_mem_ancestors_grudge_crafting
			# }
		}
	}
	upgrades = {
		mem_ancestors_grudge_building_forge_3
	}
	ai_weight = {
		base = 9997
	}
}

# ecu upgrade
mem_ancestors_grudge_building_forge_3 = {
	base_buildtime = 3600
	can_build = no
	can_be_disabled = no
	can_be_ruined = no
	can_demolish = no
	position_priority = 1
	#empire_limit = 1
	category = resource
	allow = {
		owner = {
			is_mem_runesmith = yes
		}
		custom_tooltip = mem_ancestors_grudge_building_forge_1_tt
		hidden_trigger = {
			has_planet_flag = mem_ancestors_grudge_building_forge_3
		}
		#has_planet_flag = mem_ancestors_grudge_building_forge_1
	}
	resources = {
		category = planet_buildings
		cost = {
			minerals = 15000
			influence = 200
		}
		cost = {
			trigger = {
				host_has_dlc = "Ancient Relics Story Pack"
			}
			minor_artifacts = 1200
		}
		upkeep = {
			energy = 24
			#minerals = 12
			alloys = 12
		}
		produces = {
			trigger = {
				host_has_dlc = "Ancient Relics Story Pack"
			}
			minor_artifacts = 12
		}
	}
	triggered_desc = {
		trigger = {
			NOT = {
				is_planet_class = pc_city
			}
		}
		text = mem_ancestors_grudge_building_forge_terraform_tt
	}
	inline_script = {
		script = mem_ancestors_grudge/mem_ancestors_grudge_building_forge_2
	}
	inline_script = {
		script = mem_ancestors_grudge/mem_ancestors_grudge_building_forge_1
	}
	on_built = {
		planet_event = {
			id = mem_ancestors_grudge.35
		}
		#change_pc = pc_city
	}
	upgrades = {
		mem_ancestors_grudge_building_forge_4
	}
	ai_weight = {
		base = 9998
	}
}

# modifier
mem_ancestors_grudge_building_forge_4 = {
	base_buildtime = @b3_time
	can_build = no
	can_be_disabled = no
	can_be_ruined = no
	can_demolish = no
	position_priority = 1
	#empire_limit = 1
	category = resource
	#show only for upgrades not for the building
	triggered_country_modifier = {
		weapon_archaeotech_weapon_damage_mult = 1
		mult = owner.modifier:mem_ancestors_grudge_artifact_power_produces_mult
	}
	triggered_country_modifier = {
		category_archaeostudies_research_speed_mult = 1
		mult = owner.modifier:mem_ancestors_grudge_rune_power_produces_mult
	}
	allow = {
		owner = {
			is_mem_runesmith = yes
		}
		custom_tooltip = mem_ancestors_grudge_building_forge_1_tt
		hidden_trigger = {
			has_planet_flag = mem_ancestors_grudge_building_forge_4
		}
		#has_planet_flag = mem_ancestors_grudge_building_forge_1
	}
	resources = {
		category = planet_buildings
		cost = {
			alloys = 2400
		}
		cost = {
			trigger = {
				host_has_dlc = "Ancient Relics Story Pack"
			}
			minor_artifacts = 1500
		}
		upkeep = {
			energy = 28
			#minerals = 12
			alloys = 16
		}
		produces = {
			trigger = {
				host_has_dlc = "Ancient Relics Story Pack"
			}
			minor_artifacts = 15
		}
	}
	inline_script = {
		script = mem_ancestors_grudge/mem_ancestors_grudge_building_forge_2
	}
	inline_script = {
		script = mem_ancestors_grudge/mem_ancestors_grudge_building_forge_1
	}
	ai_weight = {
		base = 9999
	}
	# on_built = {
	# 	change_pc = pc_city
	# }
	# upgrades = {
	# 	#scar_building_outpost_forge_1
	# }
}

mem_ancestors_grudge_building_robot_factory = {
	base_buildtime = @b3_time
	can_build = yes
	# can_be_disabled = no
	# can_be_ruined = no
	# can_demolish = no
	position_priority = 5
	empire_limit = 7
	base_cap_amount = 1
	category = pop_assembly
	prerequisites = {
		tech_mem_ancestors_grudge_robot_factory
	}
	# allow = {
	# 	owner = {
	# 		is_mem_runesmith = yes
	# 	}
	# 	#has_planet_flag = mem_ancestors_grudge_building_forge_1
	# }
	destroy_trigger = {
		owner = {
			NOT = {
				has_technology = tech_mem_ancestors_grudge_robot_factory
			}
		}
	}
	resources = {
		category = planet_buildings
		# cost = {
		# 	minerals = 1800
		# 	alloys = 600
		# }
		cost = {
			trigger = {
				host_has_dlc = "Ancient Relics Story Pack"
			}
			minor_artifacts = 3000
		}
		cost = {
			trigger = {
				NOT = {
					host_has_dlc = "Ancient Relics Story Pack"
				}
			}
			alloys = 2000
		}
		upkeep = {
			trigger = {
				NOT = {
					host_has_dlc = "Ancient Relics Story Pack"
				}
			}
			alloys = 4
		}
		upkeep = {
			trigger = {
				host_has_dlc = "Ancient Relics Story Pack"
			}
			minor_artifacts = 4
		}
	}
	triggered_planet_modifier = {
		potential = {
			owner = {
				NOT = {
					has_deficit = minor_artifacts
				}
			}
		}
		planet_pop_assembly_add = 10
	}
	triggered_planet_modifier = {
		potential = {
			owner = {
				NOT = {
					has_deficit = minor_artifacts
				}
			}
		}
		planet_pop_assembly_add = -0.1
		mult = this.value:mem_ancestors_grudge_factory_pop_count
	}
	triggered_desc = {
		text = mem_ancestors_grudge_building_robot_factory_tt
	}
	ai_weight = {
		base = 9996
		modifier = {
			factor = 0
			AND = {
				host_has_dlc = "Ancient Relics Story Pack"
				owner = {
					resource_income_compare = {
						resource = minor_artifacts
						value <= 10
					}
				}
			}
		}
	}
}

mem_ancestors_grudge_building_hoarder_depot = {
	base_buildtime = 136080
	category = resource
	base_cap_amount = 1
	potential = {
		NOR = {
			has_modifier = resort_colony
			has_modifier = slave_colony
		}
		from = {
			mem_ancestors_grudge_is_hoarder = yes
		}
	}
	allow = {
		exists = owner
		hidden_trigger = {
			owner = {
				is_ai = no
			}
		}
	}
	destroy_trigger = {
		NOT = {
			exists = owner
		}
		from = {
			mem_ancestors_grudge_is_hoarder = no
		}
	}
	# triggered_planet_modifier = {
	# 	potential = {
	# 		exists = owner
	# 		owner = {
	# 			is_regular_empire = yes
	# 		}
	# 	}
	# 	modifier = {
	# 		job_clerk_add = 1
	# 	}
	# }
	# triggered_planet_modifier = {
	# 	potential = {
	# 		exists = owner
	# 		owner = {
	# 			is_gestalt = yes
	# 		}
	# 	}
	# 	modifier = {
	# 		job_maintenance_drone_add = 1
	# 	}
	# }
	resources = {
		category = planet_buildings
		cost = {
			minerals = 500
			alloys = 100
		}
		upkeep = {
			energy = 5
		}
		produces = {
			trigger = {
				owner = {
					has_policy_flag = mem_ancestors_grudge_is_hoarder_policy_unity
					mem_ancestors_grudge_is_capped_hoarder = yes					#todo
				}
			}
			unity = 1
			mult = owner.value:mem_ancestors_grudge_hoarder_overflow
		}
	}
	# country_modifier = {
	# 	country_resource_max_minor_artifacts_add = 5000
	# 	#country_resource_max_add = 5000
	# }
	# triggered_country_modifier = {
	# 	potential = {
	# 		exists = owner
	# 		owner = {
	# 			has_technology = tech_construction_templates
	# 		}
	# 		host_has_dlc = "Ancient Relics Story Pack"
	# 	}
	# 	country_resource_max_minor_artifacts_add = 5000
	# }
	triggered_country_modifier = {
		potential = {
			exists = owner
			host_has_dlc = "Ancient Relics Story Pack"
		}
		country_resource_max_minor_artifacts_add = 10000
	}
	# triggered_country_modifier = {
	# 	potential = {
	# 		exists = owner
	# 		owner = {
	# 			has_technology = tech_construction_templates
	# 		}
	# 		NOT = {
	# 			host_has_dlc = "Ancient Relics Story Pack"
	# 		}
	# 	}
	# 	country_resource_max_energy_add = 100000
	# }
	triggered_country_modifier = {
		potential = {
			exists = owner
			NOT = {
				host_has_dlc = "Ancient Relics Story Pack"
			}
		}
		country_resource_max_energy_add = 100000
	}
	# prerequisites = {
	# 	"tech_basic_industry"
	# }
	# triggered_desc = {
	# 	trigger = {
	# 		exists = owner
	# 		owner = {
	# 			is_gestalt = yes
	# 		}
	# 	}
	# 	text = job_maintenance_drone_effect_desc
	# }
	# triggered_desc = {
	# 	trigger = {
	# 		exists = owner
	# 		owner = {
	# 			is_gestalt = no
	# 		}
	# 	}
	# 	text = job_clerk_effect_desc
	# }
}
