###########
# trime_scripted_effects
# made by:
# tr33
#
###########
# spawns the system
spawn_trime = {
	if = {
		limit = {
			NOT = {
				has_global_flag = trime_system_spawned
			}
		}
		set_global_flag = trime_system_spawned
		spawn_system = {
			initializer = trime_orgin_system
		}
	}
	last_created_system = {
		log = "spawned \\[This.GetName\\]"
	}
}

# ends al levents related to him
trime_endallevents = {
	if = {
		limit = {
			has_event_chain = trime_buildtemple
		}
		end_event_chain = trime_buildtemple
	}
	if = {
		limit = {
			has_event_chain = trime_decoded_messages_chain
		}
		end_event_chain = trime_decoded_messages_chain
	}
	if = {
		limit = {
			has_special_project = trime_make_lightshow
		}
		abort_special_project = {
			type = trime_make_lightshow
		}
	}
	if = {
		limit = {
			has_special_project = trime_decode_message
		}
		abort_special_project = {
			type = trime_decode_message
		}
	}
}

# change his portrait depending on age
trime_setportrait = {
	this = {
		#set_variable = {
		#	which = trime_death_age
		#	value = this.trigger:leader_age
		#}
		if = {
			limit = {
				event_target:trime_time_lord = {
					leader_age < 100
				}
			}
			event_target:trime_time_lord = {
				change_leader_portrait = GFX_trime_time_lord_stage1
			}
		}
		else_if = {
			limit = {
				event_target:trime_time_lord = {
					leader_age < 300
				}
			}
			event_target:trime_time_lord = {
				change_leader_portrait = GFX_trime_time_lord_stage2
				if = {
					limit = {
						NOT = {
							has_leader_flag = trime_power_unlocked2
						}
					}
					leader_event = {
						id = trime.200
					}
					
					set_leader_flag = trime_power_unlocked2
				}
			}
		}
		else_if = {
			limit = {
				event_target:trime_time_lord = {
					leader_age < 600
				}
			}
			event_target:trime_time_lord = {
				change_leader_portrait = GFX_trime_time_lord_stage3
				if = {
					limit = {
						NOT = {
							has_leader_flag = trime_power_unlocked3
						}
					}
					leader_event = {
						id = trime.200
					}
					set_leader_flag = trime_power_unlocked3
				}
			}
		}
		else_if = {
			limit = {
				event_target:trime_time_lord = {
					leader_age < 1000
				}
			}
			event_target:trime_time_lord = {
				change_leader_portrait = GFX_trime_time_lord
				if = {
					limit = {
						NOT = {
							has_leader_flag = trime_power_unlocked4
						}
					}
					leader_event = {
						id = trime.200
					}
					set_leader_flag = trime_power_unlocked4
				}
			}
		}
		else = {
			event_target:trime_time_lord = {
				change_leader_portrait = GFX_trime_time_lord_stageultimate
				if = {
					limit = {
						NOT = {
							has_leader_flag = trime_power_unlocked5
						}
					}
					leader_event = {
						id = trime.201
					}
					set_leader_flag = trime_power_unlocked5
				}
			}
		}
	}
}
